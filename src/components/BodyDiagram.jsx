import { useState } from 'react'
import { useWorkout } from '../context/WorkoutContext'
import {
  getAggregateMuscleColor,
  getAggregateVolumeAndTarget,
  getAggregateMusclePercentage,
  getDetailedMusclesForDiagram
} from '../utils/volumeCalculator'
import { MUSCLE_NAMES } from '../data/exercises'
import MuscleTargetConfig from './MuscleTargetConfig'
import './BodyDiagram.css'

// Display names for diagram areas (overrides MUSCLE_NAMES for tooltip titles only)
const DIAGRAM_DISPLAY_NAMES = {
  'lats': 'Back',
  'posterior-delt': 'Shoulders',
  'traps': 'Shoulders',
  'deltoids': 'Shoulders',
  'gastrocnemius': 'Calves',
  'quads': 'Legs',
  'gluteus-maximus': 'Legs',
  'biceps-femoris': 'Legs',
}

// Muscles that should highlight together when hovering
const HOVER_GROUPS = {
  // Shoulders group (front view): deltoids + traps
  'deltoids': ['deltoids', 'traps'],
  'traps': ['deltoids', 'traps'],
  // Shoulders group (back view): posterior-delt + traps
  'posterior-delt': ['posterior-delt', 'traps'],
  // Legs group (front view): quads
  'quads': ['quads'],
  // Legs group (back view): gluteus-maximus + biceps-femoris (glutes + hamstrings)
  'gluteus-maximus': ['gluteus-maximus', 'biceps-femoris'],
  'biceps-femoris': ['gluteus-maximus', 'biceps-femoris'],
}

function BodyDiagram() {
  const { state } = useWorkout()
  const { muscleVolume, muscleTargets } = state
  const [hoveredMuscle, setHoveredMuscle] = useState(null)
  const [view, setView] = useState('back')
  const [showConfig, setShowConfig] = useState(false)

  const getMuscleColor = (muscleId) => {
    return getAggregateMuscleColor(muscleId, muscleVolume, muscleTargets)
  }

  const handleMouseEnter = (muscleId) => setHoveredMuscle(muscleId)
  const handleMouseLeave = () => setHoveredMuscle(null)

  // Check if a muscle should be highlighted based on hover groups
  const isHovered = (muscleId) => {
    if (!hoveredMuscle) return false
    if (hoveredMuscle === muscleId) return true
    // Check if both muscles are in the same hover group
    const hoveredGroup = HOVER_GROUPS[hoveredMuscle]
    if (hoveredGroup && hoveredGroup.includes(muscleId)) return true
    return false
  }

  const muscleProps = (muscleId) => ({
    fill: getMuscleColor(muscleId),
    stroke: '#0a0a0a',
    strokeWidth: 0.5,
    onMouseEnter: () => handleMouseEnter(muscleId),
    onMouseLeave: handleMouseLeave,
    className: `muscle-path ${isHovered(muscleId) ? 'hovered' : ''}`,
    style: { cursor: 'pointer' }
  })

  // Get color based on percentage: red < 50%, yellow 50-99%, green 100%+
  const getPercentageColor = (current, target) => {
    if (target === 0) return '#666'
    const pct = (current / target) * 100
    if (pct >= 100) return '#22c55e' // Green
    if (pct >= 50) return '#eab308'  // Yellow
    return '#ef4444'                  // Red
  }

  const renderTooltip = () => {
    if (!hoveredMuscle) return null
    const { volume, target } = getAggregateVolumeAndTarget(hoveredMuscle, muscleVolume, muscleTargets)
    const name = DIAGRAM_DISPLAY_NAMES[hoveredMuscle] || MUSCLE_NAMES[hoveredMuscle] || hoveredMuscle
    const percentage = getAggregateMusclePercentage(hoveredMuscle, muscleVolume, muscleTargets)
    const detailedMuscles = getDetailedMusclesForDiagram(hoveredMuscle)
    const mainColor = getPercentageColor(volume, target)

    return (
      <div className="tooltip">
        <strong>{name}</strong>
        <span>{volume.toFixed(1)} / {target} sets</span>
        <span className="tooltip-percentage">{percentage}</span>
        {detailedMuscles && (
          <div className="tooltip-breakdown">
            {detailedMuscles.map(muscleId => {
              const muscleVol = muscleVolume[muscleId] || 0
              const muscleTgt = muscleTargets[muscleId] || 0
              const muscleName = MUSCLE_NAMES[muscleId] || muscleId
              const rowColor = getPercentageColor(muscleVol, muscleTgt)
              return (
                <div key={muscleId} className="tooltip-muscle-row">
                  <span className="tooltip-muscle-name" style={{ color: rowColor }}>{muscleName}</span>
                  <span className="tooltip-muscle-sets" style={{ color: rowColor }}>{muscleVol.toFixed(1)} / {muscleTgt}</span>
                </div>
              )
            })}
          </div>
        )}
      </div>
    )
  }

  const renderBackView = () => (
    <svg viewBox="0 0 267.43356 490.42377" className="body-svg" preserveAspectRatio="xMidYMid meet">
      <g transform="translate(-29.878109,-47.973808)">
        {/* Traps - Left */}
        <path d="m 97.314366,100.27183 8.658614,-11.775715 21.47335,-11.083023 15.23916,-6.92689 9.3513,-12.122058 2.77076,-9.697645 7.61957,-0.692689 1.38538,12.468401 -9.00495,20.780669 -16.62454,1.385378 14.54647,0.692689 8.31227,8.312268 2.77075,15.239155 -3.46344,54.02974 -6.92689,10.39034 -17.66357,-33.59542 -9.69765,-13.50743 10e-6,-11.08302 -4.15614,-10.39034 -7.27323,-1.73172 z"
          {...muscleProps('traps')} />

        {/* Traps - Right */}
        <path d="m 229.61795,100.27183 -8.65861,-11.775715 -21.47335,-11.083023 -15.23916,-6.92689 -9.3513,-12.122058 -2.77076,-9.697645 -7.61957,-0.692689 -1.38538,12.468401 9.00495,20.780669 16.62454,1.385378 -14.54647,0.692689 -8.31227,8.312268 -2.77075,15.239155 3.46344,54.02974 6.92689,10.39034 17.66357,-33.59542 9.69765,-13.50743 -1e-5,-11.08302 4.15614,-10.39034 7.27323,-1.73172 z"
          {...muscleProps('traps')} />

        {/* Rear Delt - Left */}
        <path d="m 121.22676,112.16536 -15.42886,-10.53081 -7.347084,-2.93883 -7.10217,-1.46941 -3.67354,-0.244906 -5.63276,2.204126 -6.12256,3.67353 -5.877661,7.10218 -4.898051,10.041 -2.204123,10.04101 1.469416,7.59197 2.449025,1.95923 4.408246,-8.57159 4.163338,-5.63276 7.34708,-2.20412 6.85727,-1.46942 8.32669,-1.71432 4.653154,-2.44902 6.61236,-2.44903 7.10218,-1.95922 z"
          {...muscleProps('posterior-delt')} />

        {/* Rear Delt - Right */}
        <path d="m 206.45284,112.16536 15.42886,-10.53081 7.34708,-2.93883 7.10217,-1.46941 3.67354,-0.244906 5.63276,2.204126 6.12256,3.67353 5.87767,7.10218 4.89805,10.041 2.20412,10.04101 -1.46942,7.59197 -2.44902,1.95923 -4.40825,-8.57159 -4.16334,-5.63276 -7.34708,-2.20412 -6.85727,-1.46942 -8.32669,-1.71432 -4.65315,-2.44902 -6.61236,-2.44903 -7.10218,-1.95922 z"
          {...muscleProps('posterior-delt')} />

        {/* Triceps - Left */}
        <path d="m 88.654716,123.18598 1.95922,16.40847 2.69393,5.14295 -0.2449,5.14295 v 3.42864 l -0.73471,8.08178 0.73471,4.65315 1.95922,1.46941 -1.71432,7.34708 -3.91844,9.06139 -6.12256,5.63276 -10.04101,6.61237 -1.714316,1.95922 0.244906,-6.61237 -6.122567,3.18374 -5.387855,2.20412 -5.877661,-0.48981 -2.204123,-0.7347 -2.204123,2.20412 -4.408246,4.65315 -1.469415,2.44902 -2.204123,-5.63276 0.244903,-5.14295 2.93883,-4.16334 0.244903,-5.38786 1.95922,-4.65315 2.204123,-1.22451 1.224513,-13.95944 0.244902,-6.85727 1.714318,-7.10218 2.93883,-5.63276 5.877661,-4.40824 4.163343,-1.71432 2.204123,0.2449 2.204123,-6.12256 4.898051,-7.10217 0.4898,-1.22452 5.63276,-1.22451 z"
          {...muscleProps('triceps')} />

        {/* Triceps - Right */}
        <path d="m 238.53508,123.67579 -1.95922,16.40847 -2.69393,5.14295 0.2449,5.14295 v 3.42864 l 0.73471,8.08178 -0.73471,4.65315 -1.95922,1.46941 1.71432,7.34708 3.91844,9.06139 6.12256,5.63276 10.04101,6.61237 1.71431,1.95922 -0.2449,-6.61237 6.12256,3.18374 5.38786,2.20412 5.87766,-0.48981 2.20412,-0.7347 2.20413,2.20412 4.40824,4.65315 1.46942,2.44902 2.20412,-5.63276 -0.2449,-5.14295 -2.93883,-4.16334 -0.24491,-5.38786 -1.95922,-4.65315 -2.20412,-1.22451 -1.22451,-13.95944 -0.2449,-6.85727 -1.71432,-7.10218 -2.93883,-5.63276 -5.87766,-4.40824 -4.16335,-1.71432 -2.20412,0.2449 -2.20412,-6.12256 -4.89805,-7.10217 -0.4898,-1.22452 -5.63276,-1.22451 z"
          {...muscleProps('triceps')} />

        {/* Lats/Back - Left */}
        <path d="m 161.63568,181.71768 -25.46987,-45.55187 -9.7961,-9.7961 -0.4898,-9.3063 -4.40825,-4.40824 -12.73493,2.93883 -9.306304,4.40824 -9.7961,2.44903 -0.4898,6.85727 1.95922,10.28591 2.93883,5.38785 -0.97961,11.26552 -1.46942,7.83688 4.40825,3.91844 2.44902,9.3063 11.265524,8.81649 10.28591,9.7961 0.34634,5.88786 -1.81576,4.39804 -3.42863,7.83689 2.44902,5.87766 -0.4898,11.26551 -3.91845,11.26552 -0.4898,8.81649 7.83688,-0.37095 6.62977,-3.42864 6.22401,-8.18323 10.28591,-1.69692 7.22823,-0.63326 2.93883,1.75634 2.73594,5.53132 1.78095,3.71556 4.7894,1.84037 z"
          {...muscleProps('lats')} />

        {/* Lats/Back - Right */}
        <path d="m 165.06431,182.20749 25.46987,-45.55187 9.7961,-9.7961 0.4898,-9.3063 4.40825,-4.40824 12.73493,2.93883 9.3063,4.40824 9.7961,2.44903 0.4898,6.85727 -1.95922,10.28591 -2.93883,5.38785 0.97961,11.26552 1.46942,7.83688 -4.40825,3.91844 -2.44902,9.3063 -11.26552,8.81649 -10.04101,9.5512 1.83317,-0.44779 -0.60865,10.97859 3.42863,7.83689 -2.44902,5.87766 0.4898,11.26551 3.91845,11.26552 0.4898,8.81649 -10.26129,-1.06364 -5.59074,-3.77499 -4.14594,-5.41247 -8.90053,-2.73595 -8.26727,-0.28692 -1.89979,0.71731 -1.69691,4.14594 -5.2444,5.79363 -4.44305,1.14768 z"
          {...muscleProps('lats')} />

        {/* Glutes - Left */}
        <path d="m 163.5949,252.24961 0.4898,23.02084 -2.44902,9.3063 -6.36747,6.36746 -13.22474,2.44903 h -9.7961 l -7.83688,0.97961 -3.91844,0.97961 -1.46941,-8.32669 2.93883,-7.34708 2.93883,-5.87766 1.46941,-3.91844 0.48981,-7.83688 v -5.38785 -2.93883 l -5.87766,-2.44903 6.85727,-6.36747 2.44902,-4.89805 4.89805,-3.42863 10.28591,-1.46942 5.38786,-1.46941 6.85727,9.30629 z"
          {...muscleProps('gluteus-maximus')} />

        {/* Glutes - Right */}
        <path d="m 163.5949,252.73941 -0.4898,23.02084 2.44902,9.3063 6.36747,6.36746 13.22474,2.44903 h 9.7961 l 7.83688,0.97961 3.91844,0.97961 1.46941,-8.32669 -2.93883,-7.34708 -2.93883,-5.87766 -1.46941,-3.91844 -0.48981,-7.83688 v -5.38785 -2.93883 l 5.87766,-2.44903 -6.85727,-6.36747 -2.44902,-4.89805 -4.89805,-3.42863 -10.28591,-1.46942 -5.38786,-1.46941 -6.85727,9.30629 z"
          {...muscleProps('gluteus-maximus')} />

        {/* Hamstrings - Left */}
        <path d="m 158.45916,291.43402 v 45.55187 l -2.44903,8.81649 -0.4898,14.20435 v 10.2859 l -2.93883,15.18396 -5.38786,13.71454 -7.03554,7.83688 2.13749,2.93883 -3.42864,-5.87766 c -3.8184,-2.12249 -4.30997,3.72095 -1.6723,1.59846 l -1.79114,-3.41844 1.30134,0.21307 -4.12133,-2.18671 -0.65787,-0.92019 -3.97787,1.61288 -1.46942,-0.35654 -1.67229,0.31153 -2.04326,-2.58228 -2.50845,0.87096 -1.95922,7.09496 -2.87941,-5.34883 -4.12132,-0.35653 -7.01093,-1.04326 -8.658613,-20.65163 -1.385376,-8.82668 -2.735958,-9.60342 -1.172288,-8.09918 -0.227498,-20.7399 7.619579,-8.87591 2.305564,-10.69168 3.5721,-8.90052 9.3063,-7.34708 10.2859,-2.44902 14.20435,-0.48981 10.77571,-1.46941 z"
          {...muscleProps('biceps-femoris')} />

        {/* Hamstrings - Right */}
        <path d="m 165.60684,292.8194 v 45.55187 l 2.44903,8.81649 0.4898,14.20435 v 10.2859 l 2.93883,15.18396 5.38787,13.71454 7.03554,7.83688 -2.13749,2.93883 3.42864,-5.87766 c 3.8184,-2.12249 4.30997,3.72095 1.6723,1.59846 l 1.79114,-3.41844 -1.30134,0.21307 4.12133,-2.18671 0.65787,-0.92019 3.97787,1.61288 1.46942,-0.35654 1.67229,0.31153 2.04326,-2.58228 2.50845,0.87096 1.95922,7.09496 2.87941,-5.34883 4.12132,-0.35653 7.01093,-1.04326 8.65861,-20.65163 1.38538,-8.82668 2.73595,-9.60342 1.17229,-8.09918 0.2275,-20.7399 -7.61958,-8.87591 -2.30556,-10.69168 -3.5721,-8.90052 -9.3063,-7.34708 -10.2859,-2.44902 -14.20435,-0.48981 -10.77571,-1.46941 z"
          {...muscleProps('biceps-femoris')} />

        {/* Calves - Left */}
        <path d="m 128.99053,397.56087 h -2.44902 l -3.67354,1.22451 -2.20412,-0.48981 -2.93884,0.2449 -2.69393,-0.4898 -3.67354,0.2449 c 0,0 -0.4898,-0.7347 -1.46941,0.24491 -0.97961,0.97961 -2.93883,-0.24491 -2.93883,-0.24491 l -1.71432,4.89805 -2.44902,5.14296 -1.71433,5.38785 -1.959218,6.61237 v 7.34708 c 0,0 -0.2449,8.57158 -0.2449,9.7961 0,1.22451 6.122568,8.32668 6.122568,8.32668 l 4.89805,21.30652 7.10218,20.81672 2.44902,8.81649 -1.46941,11.26552 -0.73471,2.93883 24.24535,2.44902 0.2449,-3.42863 -1.46941,-6.12257 -1.46942,-5.87766 v -10.2859 -9.5512 -5.14295 l 3.18373,-8.32669 2.69393,-7.83688 2.44903,-9.3063 1.22451,-14.20435 c 0,0 0.2449,-7.10217 0.2449,-8.81649 0,-1.71431 -4.16334,-13.71454 -4.16334,-13.71454 l -0.48981,-3.42863 -2.44902,-4.65315 -0.97961,-3.91844 v -1.95922 l -1.95922,-1e-5 -3.67354,0.48981 -2.93883,-0.4898 -1.46941,-0.2449 z"
          {...muscleProps('gastrocnemius')} />

        {/* Calves - Right */}
        <path d="m 193.96281,398.94624 h 2.44902 l 3.67354,1.22451 2.20412,-0.48981 2.93884,0.2449 2.69393,-0.4898 3.67354,0.2449 c 0,0 0.4898,-0.7347 1.46941,0.24491 0.97961,0.97961 2.93883,-0.24491 2.93883,-0.24491 l 1.71432,4.89805 2.44902,5.14296 1.71432,5.38785 1.95922,6.61237 v 7.34708 c 0,0 0.2449,8.57158 0.2449,9.7961 0,1.22451 -6.12256,8.32668 -6.12256,8.32668 l -4.89805,21.30652 -7.10218,20.81672 -2.44902,8.81649 1.46941,11.26552 0.73471,2.93883 -24.24535,2.44902 -0.2449,-3.42863 1.46941,-6.12257 1.46942,-5.87766 v -10.2859 -9.5512 -5.14295 l -3.18373,-8.32669 -2.69393,-7.83688 -2.44903,-9.3063 -1.22451,-14.20435 c 0,0 -0.2449,-7.10217 -0.2449,-8.81649 0,-1.71431 4.16334,-13.71454 4.16334,-13.71454 l 0.48981,-3.42863 2.44902,-4.65315 0.97961,-3.91844 v -1.95922 l 1.95922,-10e-6 3.67354,0.48981 2.93883,-0.4898 1.46941,-0.2449 z"
          {...muscleProps('gastrocnemius')} />

        {/* Foot - Left (decorative) */}
        <path d="m 141.30011,516.92424 -0.69269,12.4684 v 8.65862 l -6.2342,0.34634 -14.20013,-1.03903 -12.81474,-1.03904 h -5.19517 l 0.69269,-7.61957 c 0,0 1.73172,-1.03904 3.1171,-1.03904 1.38538,0 3.80979,-0.69269 3.80979,-0.69269 l 4.84882,-3.46344 3.80979,-4.15614 0.69269,-5.19516"
          fill="#666666" stroke="#0a0a0a" strokeWidth="0.5" />

        {/* Foot - Right (decorative) */}
        <path d="m 184.24682,516.5779 0.69269,12.4684 v 8.65862 l 6.2342,0.34634 14.20013,-1.03903 12.81474,-1.03904 h 5.19517 l -0.69269,-7.61957 c 0,0 -1.73172,-1.03904 -3.1171,-1.03904 -1.38538,0 -3.80979,-0.69269 -3.80979,-0.69269 l -4.84882,-3.46344 -3.80979,-4.15614 -0.69269,-5.19516"
          fill="#666666" stroke="#0a0a0a" strokeWidth="0.5" />

        {/* Forearms - Left */}
        <path d="m 71.51154,195.43222 1.469416,20.08201 -5.387856,14.20435 -10.285907,17.63298 -3.91844,11.75532 -1.469416,8.32669 -18.122787,1.95922 -3.918441,-9.3063 1.959221,-9.30629 0.489805,-6.85728 v -11.26551 -9.7961 l 1.95922,-15.18396 5.877661,-7.83688 4.408245,7.34707 3.918441,-5.87766 3.91844,-3.91844 h 6.367466 z"
          {...muscleProps('forearms')} />

        {/* Forearms - Right */}
        <path d="m 255.67825,195.92202 -1.46941,20.08201 5.38785,14.20435 10.28591,17.63298 3.91844,11.75532 1.46941,8.32669 18.12279,1.95922 3.91844,-9.3063 -1.95922,-9.30629 -0.4898,-6.85728 v -11.26551 -9.7961 l -1.95922,-15.18396 -5.87766,-7.83688 -4.40825,7.34707 -3.91844,-5.87766 -3.91844,-3.91844 h -6.36747 z"
          {...muscleProps('forearms')} />

        {/* Upper Back Detail - Left (decorative) */}
        <path d="m 103.21066,331.45167 -3.463448,-27.36121 3.463448,-20.08798 6.2342,-14.54647 5.19517,-19.04895 h 7.27323 l 4.84882,2.42441 2.07807,1.73173 -1.38538,11.08302 v 4.84882 l -4.50248,9.3513 -2.77075,5.54152 0.34634,5.54151 1.38538,4.15613 -6.2342,2.07807 -4.84882,4.50248 -4.84883,9.69764 -3.46344,16.62454 z"
          fill="#666666" stroke="#0a0a0a" strokeWidth="0.5" />

        {/* Upper Back Detail - Right (decorative) */}
        <path d="m 219.77083,331.84511 2.92744,-27.47815 -2.92744,-20.17382 -2.84497,-14.26229 -4.39116,-20.51573 -8.57202,1.03903 -4.0984,2.43477 -1.75647,1.73914 1.17098,11.13038 v 4.86954 l 3.80566,9.39127 2.34195,5.56519 -2.02446,9.02864 -0.82464,3.82754 5.96207,2.08696 4.09841,3.48269 4.79111,7.66101 2.92743,16.69558 z"
          fill="#666666" stroke="#0a0a0a" strokeWidth="0.5" />
      </g>
    </svg>
  )

  const renderFrontView = () => (
    <svg viewBox="0 0 267.43356 490.42377" className="body-svg" preserveAspectRatio="xMidYMid meet">
      <g transform="translate(268.95875,-49.409262)">
        <g transform="matrix(1.2588104,0,0,1.1035935,-289.14365,-19.694076)">
          {/* Pec Major - Right */}
          <path d="m 119.51243,109.22653 3.67355,-4.89805 7.10217,-4.653148 12.73493,-1.224513 h 3.67354 l 7.59198,3.673541 9.06139,4.65315 11.02061,8.57158 12.24513,7.83688 5.38786,2.44903 1.71431,3.18373 -1.71431,3.18374 -9.7961,1.71431 -9.3063,11.51042 -11.51042,3.42864 -6.12256,2.69393 -5.38786,0.97961 -8.32668,-0.73471 h -6.61237 l -4.65315,-0.73471 -5.38786,-3.18373 -2.93883,-2.44903 -1.46941,-4.40824 -0.97961,-18.6126 0.4898,-6.85727 z"
            {...muscleProps('pec-major')} />

          {/* Pec Major - Left */}
          <path d="m 120.49204,108.98163 -3.67355,-4.89805 -7.10217,-4.653151 -12.734928,-1.224513 h -3.67354 l -7.59198,3.673544 -9.06139,4.65315 -11.02061,8.57158 -12.24513,7.83688 -5.38786,2.44903 -1.71431,3.18373 1.71431,3.18374 9.7961,1.71431 9.3063,11.51042 11.51042,3.42864 6.12256,2.69393 5.38786,0.97961 8.32668,-0.73471 h 6.612368 l 4.65315,-0.73471 5.38786,-3.18373 2.93883,-2.44903 1.46941,-4.40824 0.97961,-18.6126 -0.4898,-6.85727 z"
            {...muscleProps('pec-major')} />

          {/* Deltoids - Left */}
          <path d="m 75.185079,101.38965 -0.498933,6.85727 -6.236648,5.38786 -6.236648,3.91844 -7.234513,4.40824 -6.236648,3.18374 -1.995727,4.16334 1.995727,2.69393 8.980774,0.97961 -0.249466,1.46941 -5.737717,0.73471 -5.987183,5.63276 -1.995727,3.67354 -3.991454,-5.87767 -2.245194,-5.14295 -2.49466,-4.16334 v -9.7961 l 5.737717,-12.49003 5.737716,-6.36747 7.234513,-4.653146 11.225967,0.244902 2.245194,1.95922 5.987181,0.979611 z"
            {...muscleProps('deltoids')} />

          {/* Deltoids - Right */}
          <path d="m 164.90029,101.65337 0.48981,6.85727 6.12256,5.38787 6.12256,3.91844 7.10218,4.40824 6.12256,3.18374 1.95922,4.16334 -1.95922,2.69393 -8.81649,0.97961 0.2449,1.46941 5.63276,0.73471 5.87766,5.63276 1.95922,3.67354 8.57159,-2.44903 2.20413,-3.91844 2.69392,-4.89805 -0.97961,-14.93905 -5.38786,-11.02063 -7.59198,-6.85727 -9.30629,-4.408243 -11.02061,0.244902 -2.20413,1.95922 -5.87766,0.979611 z"
            {...muscleProps('deltoids')} />

          {/* Biceps - Left */}
          <path d="m 59.432798,132.73718 c -2.46772,0.25101 -6.662845,1.25512 -6.662845,1.25512 l -6.416072,4.51845 -3.70158,5.77358 -3.454809,13.30433 -1.727405,9.53895 1.974177,11.04511 4.195125,4.76947 c 0,0 9.130564,-2.0082 10.117652,-2.0082 0.987088,0 8.63702,-7.27972 8.63702,-7.27972 l 4.441897,-11.04511 2.714492,-9.28793 0.246772,-8.28383 -6.662844,-5.77358 z"
            {...muscleProps('biceps')} />

          {/* Biceps - Right */}
          <path d="m 180.90573,133.69561 c 2.90223,0.26304 7.83603,1.3153 7.83603,1.3153 l 7.54583,4.73508 4.35335,6.05038 4.06313,13.94219 2.03158,9.99628 -2.32179,11.57465 -4.93382,4.99814 c 0,0 -10.73828,-2.10448 -11.89918,-2.10448 -1.16088,0 -10.1578,-7.62874 -10.1578,-7.62874 l -5.22404,-11.57465 -3.19248,-9.73323 -0.29021,-8.68098 7.83604,-6.05038 z"
            {...muscleProps('biceps')} />

          {/* Triceps - Right */}
          <path d="m 203.2691,186.61573 -1.71431,-3.67354 4.40824,-11.75532 -1.71432,-8.81649 -5.38785,-18.61259 5.87766,-1.95922 1.71432,-2.93883 9.06139,6.85727 4.65315,8.81649 -1.46942,11.75532 0.24491,8.08178 1.46941,5.87767 -7.59198,-10.04101 -6.61237,11.75532 z"
            {...muscleProps('triceps')} />

          {/* Triceps - Left */}
          <path d="M 39.429308,178.04414 33.79655,165.55411 c 0,0 -5.877661,10.53081 -6.612369,6.12257 -0.734707,-4.40825 1.469416,-7.83688 1.469416,-13.46964 0,-5.63276 1.469415,-11.26552 1.469415,-11.26552 l 8.816491,-9.06139 4.653148,6.36746 -3.91844,12.73493 -1.959221,10.28591 z"
            {...muscleProps('triceps')} />

          {/* Traps - Left */}
          <path d="m 65.144074,98.205916 18.122788,0.244903 c 0,0 10.946252,0.366859 11.755321,-1.469415 1.016643,-2.307386 6.367467,-6.122564 6.367467,-6.122564 l 1.22451,-5.142953 V 74.205468 l -6.367464,7.836881 -10.775711,3.428636 -10.775712,5.387855 z"
            {...muscleProps('traps')} />

          {/* Traps - Right */}
          <path d="m 177.71566,96.423932 -25.95967,1.325172 c 0,0 -1.71432,0.530068 -2.69393,-1.060137 -0.97961,-1.590205 -6.12256,-9.2762 -6.12256,-9.2762 L 141.47009,84.49739 V 72.04078 l 6.36746,8.481096 10.77571,3.71048 10.77571,5.830754 z"
            {...muscleProps('traps')} />

          {/* Abs - Upper Left */}
          <path d="m 119.75734,148.65584 -0.48981,16.89827 -5.87766,-2.44902 -2.69392,-1.46942 -5.87767,0.73471 -6.857266,-0.4898 -3.673538,-2.44903 0.244902,-4.40825 h 8.081782 l 7.10218,-1.95922 5.38785,-3.42863 2.20412,-2.44903 z"
            {...muscleProps('abs')} />

          {/* Abs - Upper Right */}
          <path d="m 120.49205,148.16603 0.48981,16.89827 5.87766,-2.44902 2.69392,-1.46942 5.87767,0.73471 6.85726,-0.4898 3.67354,-2.44903 -0.2449,-4.40825 h -8.08178 l -7.10218,-1.95922 -5.38785,-3.42863 -2.20412,-2.44903 z"
            {...muscleProps('abs')} />

          {/* Abs - Middle Right */}
          <path d="m 143.51289,161.39077 -4.40825,2.44903 -7.10217,-0.73471 -6.61237,1.95922 -4.40825,0.4898 v 10.77571 l 2.93883,3.91845 7.83688,-0.97961 10.04101,-0.24491 2.44902,-3.42863 1.95922,-4.89805 -0.7347,-6.12257 z"
            {...muscleProps('abs')} />

          {/* Abs - Middle Left */}
          <path d="m 97.226296,161.14587 4.408254,2.44903 7.10217,-0.73471 6.61237,1.95922 4.40825,0.4898 v 10.77571 l -2.93883,3.91845 -7.83688,-0.97961 -10.041014,-0.24491 -2.44902,-3.42863 -1.95922,-4.89805 0.7347,-6.12257 z"
            {...muscleProps('abs')} />

          {/* Abs - Lower Right */}
          <path d="m 120.73695,180.49318 0.24491,11.26551 7.59198,1.22452 11.26551,-2.69393 2.69393,-7.83688 -0.4898,-1.71432 -11.26552,0.97961 z"
            {...muscleProps('abs')} />

          {/* Abs - Lower Left */}
          <path d="m 119.02262,180.00336 -0.24491,11.26551 -7.59198,1.22452 -11.265505,-2.69393 -2.693923,-7.83688 0.4898,-1.71432 11.265508,0.97961 z"
            {...muscleProps('abs')} />

          {/* Abs - Lower Center */}
          <path d="m 100.16514,193.65541 0.2368,19.54087 7.57763,24.24951 5.44642,12.24248 7.10402,3.29605 8.52484,-4.23778 5.20962,-14.36136 3.0784,-14.36137 2.60482,-13.8905 0.7104,-13.41963 -8.99844,2.35432 -24.39049,-0.23543 z"
            {...muscleProps('abs')} />

          {/* Obliques - Right (combined with Abs) */}
          <path d="m 144.772,219.92875 -4.15614,-19.04895 1.73172,-19.04894 4.15614,-11.42937 0.69269,-12.81475 -1.03904,-4.84882 8.65862,-1.03904 6.92688,-2.07806 4.50248,-1.38538 -5.54151,8.31227 2.77076,2.07806 -1.73173,8.31227 2.42442,-0.34634 -4.50248,10.04399 6.58054,-1.03904 -7.27323,9.00496 0.34634,15.5855 1.38538,8.65862 -3.1171,6.92688 c 0,0 -2.42441,-1.73172 -4.84882,-1.73172 -2.42441,0 -7.96592,5.88786 -7.96592,5.88786 z"
            {...muscleProps('abs')} />

          {/* Obliques - Left (combined with Abs) */}
          <path d="m 94.89838,219.58241 4.15614,-19.04895 -1.73172,-19.04894 -4.15614,-11.42937 -0.69269,-12.81475 1.03904,-4.84882 -8.65862,-1.03904 -6.92688,-2.07806 -4.50248,-1.38538 5.54151,8.31227 -2.77076,2.07806 1.73173,8.31227 -2.42442,-0.34634 4.50248,10.04399 -6.58054,-1.03904 7.27323,9.00496 -0.34634,15.5855 -1.38538,8.65862 3.1171,6.92688 c 0,0 2.42441,-1.73172 4.84882,-1.73172 2.42441,0 7.96592,5.88786 7.96592,5.88786 z"
            {...muscleProps('abs')} />

          {/* Lats - Left (front view, decorative) */}
          <path d="m 70.565054,148.73668 2.77075,0.69269 4.15614,5.88786 -2.94393,1.73172 1.73172,7.61958 -1.90489,-0.34634 3.80979,10.21716 -6.2342,-1.38538 3.29027,5.54151 4.50248,5.36834 -0.34635,16.27819 -1.38538,7.44641 -2.07806,-3.98296 0.51951,-7.96593 0.86586,-5.71468 -3.80978,-8.83178 -10.04399,-8.83179 6.92689,-16.97088 z"
            fill="#666666" stroke="#0a0a0a" strokeWidth="0.5" />

          {/* Lats - Right (front view, decorative) */}
          <path d="m 168.49659,150.14033 -2.77075,0.69269 -4.15614,5.88786 2.94393,1.73172 -1.73172,7.61958 1.90489,-0.34634 -3.80979,10.21716 6.2342,-1.38538 -3.29027,5.54151 -4.50248,5.36834 0.34635,16.27819 1.38538,7.44641 2.07806,-3.98296 -0.51951,-7.96593 -0.86586,-5.71468 3.80978,-8.83178 10.04399,-8.83179 -6.92689,-16.97088 z"
            fill="#666666" stroke="#0a0a0a" strokeWidth="0.5" />

          {/* Forearms - Left */}
          <path d="m 33.94176,167.28439 -8.312268,6.30812 -1.731722,5.60722 -4.156134,8.06038 -1.731723,18.22348 -1.731722,11.21444 2.078067,23.48024 2.770756,-1.40181 5.541511,5.05005 4.848823,1.95897 3.117101,0.35046 3.463444,-16.47121 9.004957,-7.35948 5.195167,-11.91535 2.078067,-13.6676 -0.346344,-5.95767 2.770756,-7.70993 -1.385378,-2.80362 -11.775713,3.15407 z"
            {...muscleProps('forearms')} />

          {/* Forearms - Right */}
          <path d="m 210.57745,168.66977 8.31227,6.30812 1.73172,5.60722 4.15613,8.06038 1.73172,18.22348 1.73173,11.21444 -2.07807,23.48024 -2.77076,-1.40181 -5.54151,5.05005 -4.84882,1.95897 -3.1171,0.35046 -3.46345,-16.47121 -9.00495,-7.35948 -5.19517,-11.91535 -2.07807,-13.6676 0.34635,-5.95767 -2.77076,-7.70993 1.38538,-2.80362 11.77571,3.15407 z"
            {...muscleProps('forearms')} />

          {/* Quads - Left */}
          <path d="m 85.715887,233.14721 -11.265516,7.83688 -5.387856,10.53081 -0.244903,21.06162 -4.653148,17.38808 -1.95922,12.24513 v 17.14318 l 4.89805,11.26551 6.367466,12.24513 7.836881,5.87766 7.347077,-5.87766 5.87766,3.42863 8.326682,5.87766 10.28591,0.97961 3.42864,-1.95922 3.42863,-17.14317 0.48981,-24.00045 -4.40825,-19.1024 -10.77571,-26.93928 -8.326686,-23.02084 -3.428636,-9.7961 z"
            {...muscleProps('quads')} />

          {/* Quads - Right */}
          <path d="m 161.00136,231.3054 11.26551,7.83688 4.89805,15.18396 -1.95922,15.18396 7.34708,18.61259 1.95922,12.24513 v 17.14318 l -5.14295,16.16356 -6.36747,10.28591 -7.83688,3.18373 -7.10217,-6.12256 -5.87766,3.42863 -8.32669,5.87766 -10.28591,0.97961 -2.20413,-5.38786 -4.65314,-13.71453 -0.48981,-24.00045 4.40825,-19.1024 5.38785,-22.77594 10.77572,-27.18418 6.36747,-9.7961 z"
            {...muscleProps('quads')} />

          {/* Lower Leg - Left (Calves) */}
          <path d="m 111.18575,478.04975 c 1.46942,7.83688 2.44903,8.81649 2.44903,8.81649 l -3.42864,6.36746 -25.959668,1.46942 h -7.347076 l -14.204347,-0.97961 -0.97961,-2.93883 7.347076,-2.44903 10.285906,-1.95922 7.347076,-8.32668 6.367466,-10.77571 -3.91844,-27.91889 -4.898051,-19.59221 -7.836881,-15.67376 -2.449026,-23.51064 10.775712,-24.49025 h 28.408693 l -3.91844,16.16356 9.3063,16.16357 2.44902,18.61259 -7.34707,17.63298 -1.95922,9.3063 -3.91844,23.51064 0.4898,11.26552 z"
            {...muscleProps('gastrocnemius')} />

          {/* Lower Leg - Right (Calves) */}
          <path d="m 142.02129,480.92069 c -1.46942,7.83688 -2.44903,8.81649 -2.44903,8.81649 l 3.42864,6.36746 25.95967,1.46942 h 7.34707 l 14.20435,-0.97961 0.97961,-2.93883 -7.34708,-2.44903 -10.2859,-1.95922 -7.34708,-8.32668 -2.44902,-8.81649 2.44903,-21.06162 4.89805,-24.98006 7.83688,-17.63298 -6.36748,-23.51064 -4.40824,-25.95967 -28.8985,-0.48981 -1.95922,18.12279 -5.38786,13.71454 1e-5,19.5922 7.34707,17.63298 1.95922,9.3063 3.91844,23.51064 -0.4898,11.26552 z"
            {...muscleProps('gastrocnemius')} />
        </g>
      </g>
    </svg>
  )

  return (
    <div className="body-diagram">
      <div className="view-toggle">
        <button
          className={`view-btn ${view === 'front' ? 'active' : ''}`}
          onClick={() => setView('front')}
        >
          Front
        </button>
        <button
          className={`view-btn ${view === 'back' ? 'active' : ''}`}
          onClick={() => setView('back')}
        >
          Back
        </button>
        <button
          className={`view-btn config-btn ${showConfig ? 'active' : ''}`}
          onClick={() => setShowConfig(!showConfig)}
        >
          Set Targets
        </button>
      </div>

      {renderTooltip()}

      <div className={`diagram-wrapper ${showConfig ? 'with-config' : ''}`}>
        {showConfig && (
          <div className="config-panel-left">
            <MuscleTargetConfig />
          </div>
        )}
        <div className="diagram-container">
          {view === 'back' ? renderBackView() : renderFrontView()}
        </div>
      </div>
    </div>
  )
}

export default BodyDiagram
